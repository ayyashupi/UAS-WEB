drop database loekis;
create database loekis;
use loekis;

create table users(
id int not null primary key auto_increment,
email varchar(50) not null,
name varchar(25) not null,
username varchar(25) not null,
password varchar(25) not null,
user_type varchar(5) not null);

create table gambar(
id int primary key auto_increment,
link_gambar varchar(255),
judul varchar(255),
tahun varchar(20),
pelukis varchar(255),
jumlah_like int,
deskripsi text
);

create table laporan(
id int primary key auto_increment,
nama_pelapor varchar(255),
email varchar(255),
deskripsi text,
id_gambar int,
id_pengguna int,
nama_gambar varchar(255),
foreign key (id_pengguna) references users(id)
);

create table feedback(
id int primary key auto_increment,
nama_laporan varchar(255),
email varchar(255),
deskripsi text,
id_gambar int,
id_pengguna int,
nama_gambar varchar(255),
foreign key (id_pengguna) references users(id)
);

create table permintaan_karya(
id int primary key auto_increment,
nama_peminta varchar(255),
email varchar(255),
deskripsi text,
id_pengguna int,
foreign key (id_pengguna) references users(id)
);

create table like_history(
id int primary key auto_increment,
tanggal date,
aksi varchar(255),
id_gambar int
);

create table log_gambar(
id int primary key auto_increment,
tanggal date,
aksi varchar(255),
id_gambar int,
nama_gambar varchar(255)
);

create table log_laporan(
id int primary key auto_increment,
tanggal date,
aksi varchar(255),
id_gambar int,
nama_gambar varchar(255)
);

create table user_likes(
id int primary key auto_increment,
user_id int,
post_id int
);



delimiter %%
create or replace procedure InsertGambar(
in link_i varchar(255),
in judul_i varchar(255),
in tahun_i varchar(255),
in pelukis_i varchar(255),
in jumlah_i varchar(255),
in desc_i text
)
begin

insert into gambar 
(link_gambar,judul,tahun,pelukis,jumlah_like,deskripsi)
values
(link_i,judul_i,tahun_i,pelukis_i,jumlah_i,desc_i);

end %%
delimiter ;

delimiter %%
create or replace procedure UpdateGambar(
in id_i int,
in link_i varchar(255),
in judul_i varchar(255),
in tahun_i varchar(255),
in pelukis_i varchar(255),
in jumlah_i varchar(255),
in desc_i text
)
begin

update gambar set
link_gambar = link_i,
judul = judul_i,
tahun = tahun_i,
pelukis = pelukis_i,
jumlah_like = jumlah_i,
deskripsi = desc_i
where id = id_i;

end %%
delimiter ;

delimiter %%
create or replace procedure DeleteGambar(
in id_i int
)
begin

delete from gambar where id = id_i;

end %%
delimiter ;

delimiter %%
create or replace procedure InsertUser(
in email_i varchar(255),
in name_i varchar(255),
in username_i varchar(255),
in password_i varchar(255),
in user_type_i varchar(255)
)
begin

insert into users 
(email,name,username,password,user_type)
values
(email_i,name_i,username_i,password_i,user_type_i);

end %%
delimiter ;

delimiter %%
create or replace procedure InsertLaporan(
in pelapor varchar(255),
in email_i varchar(255),
in desc_i text,
in id_gambar_i varchar(255),
in id_pengguna_i varchar(255),
in nama_gambar_i varchar(255)
)
begin

insert into laporan 
(nama_pelapor,email,deskripsi,id_gambar,id_pengguna,nama_gambar)
values
(pelapor,email_i,desc_i,id_gambar_i,id_pengguna_i,nama_gambar_i);

end %%
delimiter ;


delimiter %%
create procedure InsertLogGambar(
in aksi_i varchar(50),
in id_gambar_i int,
in nama_gambar_i varchar(255)
)
begin

insert into log_gambar
(tanggal, aksi,id_gambar,nama_gambar)
values
(now(), aksi_i,id_gambar_i,nama_gambar_i);

end %%
delimiter ;

delimiter %%
create procedure InsertLogLaporan(
in aksi_i varchar(50),
in id_gambar_i int,
in nama_gambar_i varchar(255)
)
begin

insert into log_laporan
(tanggal, aksi,id_gambar,nama_gambar)
values
(now(), aksi_i,id_gambar_i,nama_gambar_i);

end %%
delimiter ;

delimiter %%
create procedure InsertLogLike(
in aksi_i varchar(50),
in id_gambar_i int
)
begin

insert into like_history
(tanggal, aksi,id_gambar)
values
(now(), aksi_i,id_gambar_i);

end %%
delimiter ;


delimiter %%
create or replace trigger historyInsertGambar
after insert
on gambar FOR EACH ROW    
begin

call InsertLogGambar("Insert Gambar",new.id,new.judul);

end %%
delimiter ;

delimiter %%
create or replace trigger historyUpdateGambar
after update
on gambar FOR EACH ROW    
begin

call InsertLogGambar("Update Gambar",old.id,new.judul);

end %%
delimiter ;

delimiter %%
create or replace trigger historyDeleteGambar
before delete
on gambar FOR EACH ROW    
begin

call InsertLogGambar("Delete Gambar",old.id,old.judul);

end %%
delimiter ;


delimiter %%
create or replace trigger historyInsertLaporan
after insert
on laporan FOR EACH ROW    
begin

call InsertLogLaporan("Insert Laporan",new.id_gambar,new.nama_gambar);

end %%
delimiter ;

delimiter %%
create or replace trigger historyUpdateLaporan
after update
on laporan FOR EACH ROW    
begin

call InsertLogLaporan("Update Laporan",old.id_gambar,new.nama_gambar);

end %%
delimiter ;

delimiter %%
create or replace trigger historyDeleteLaporan
before delete
on laporan FOR EACH ROW    
begin

call InsertLogLaporan("Delete Laporan",old.id_gambar,old.nama_gambar);

end %%
delimiter ;

delimiter %%
create or replace trigger historyInsertLike
after insert
on user_likes FOR EACH ROW    
begin

call InsertLogLike("Insert Like",new.post_id);

end %%
delimiter ;

delimiter %%
create or replace trigger historyDeleteLike
before delete
on user_likes FOR EACH ROW    
begin

call InsertLogLike("Delete Like",old.post_id);

end %%
delimiter ;



delimiter %%
create or replace trigger insertLikesGambar
after insert
on user_likes FOR EACH ROW    
begin

update gambar 
set jumlah_like = jumlah_like+1
where id = new.post_id;

end %%
delimiter ;

delimiter %%
create or replace trigger deleteLikesGambar
after delete
on user_likes FOR EACH ROW    
begin

update gambar 
set jumlah_like = jumlah_like-1
where id = old.post_id;

end %%
delimiter ;


insert into user_likes values
(1,2,1),
(2,2,4),
(3,2,2),
(4,2,9),
(5,2,10);

call InsertUser("admin@gmail.com","Saya Admin","admin","admin","admin");
call InsertUser("user@gmail.com","Saya User","user","user","user");

call InsertGambar("https://upload.wikimedia.org/wikipedia/commons/e/ec/Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg",
"Mona Lisa","1503","Leonardo da Vinci",110423,"Gambar buatan oleh Leorando da Vinci yang mengilustrasikan perempuan bernama Lisa");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/01/teguh-ostenrik-jkt.jpg","Mendengar Langkah Hati","2007","Teguh Osterik",10442,"Gambar yang dibuat oleh Teguh Osterik");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/01/syahrizal-pahlevi-yogya.jpg","Menuju Kesederhanaan","2008","Syahrizal Pahlevi",5203,"Gambar yang dibuat oleh Syahrizal Pahlevi");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/01/syahruddin-hrp-mdn.jpg","Demokrasi","2000","Syahruddin Harahap",1502,"Gambar yang dibuat oleh Syahruddin Harahap");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/01/t-sutanto-bdg.jpg","Black Sun","2008","T. Sutanto",20022,"Gambar yang dibuat oleh T. Sutanto");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/01/taat-joeda-bdg.jpg","Semak itu Indah","2008","Taat Joeda",12000,"Gambar yang dibuat oleh Taat Joeda");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/02/tetty-mirwa-mdn.jpg","Harmony in Black","2008","Tetty Mirwa",14200,"Gambar yang dibuat oleh Tetty Mirwa");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/02/tiarma-sirait-bdg.jpg","Won't Ever Be","2008","Tiarma Dame Ruth Sirait",2124,"Gambar yang dibuat oleh Tiarma Dame Ruth Sirait");

call InsertGambar("https://sahabatgallery.files.wordpress.com/2009/02/tommy-wondra-yogya.jpg","Bermain Dengan Mimpi","2007","Tommy Wondra",1034,"Gambar yang dibuat oleh Tommy Wondra");

call InsertGambar("http://galeri-nasional.or.id/upload/collection/detail_hrAmy2ou71_53_lukisan_tidak_terbaca__bigjpg.jpg","Keterbatasan","1984","Lucia Hartini",24231,"Gambar yang dibuat oleh Lucia Hartini");

call InsertGambar("http://galeri-nasional.or.id/upload/collection/detail_zelD4d6mEo_sunarto_potret_diri__bigjpg.jpg","Potret Diri","1957","Sunarto P. R.",10442,"Lukisan Potret Diri (1957) ini merupakan salah satu lukisan yang banyak mengungkapkan wajah manusia, menggunakan pastel dalam bentukbentuk realistik dengan sapuan kuas yang halus, namun tegas. Sunarto PR. seringkali menggambar menggunakan model dan sekaligus mampu menangkap ekspresi wajah serta mengadirkan karakternya secara kuat, yaitu melalui garis, warna, dan komposisi.");

call InsertGambar("http://galeri-nasional.or.id/upload/collection/detail_59c2hVAihK_victor_vasarely__tanpa_judul__bigjpg.jpg","Tanpa Judul","1908","Victor Vasarely",12442,"Litografi ini merupakan prototipe karya Vasarely yang kemudian berkembang menjadi bentuk-bentuk optical illusion art atau yang populer dengan sebutan Optical Art (OpArt). Sebagai suatu fenomena visual awal, karya sejenis ini bercirikan perwujudan bentuk abstrak dengan pola dasar geometri dan outline-nya yang formal. Dalam proses selanjutnya, bentuk-bentuk itu semakin kompleks, tetapi dengan kecenderungan perancangan yang teratur dan terukur. Dengan demikian, dalam pandangan mata, bentuk-bentuk visual itu dapat merangsang retina, sehingga menimbulkan ilusi gerak dan menyilaukan. Efek tersebut menjadi semakin kuat, apabila bentuk-bentuknya dibuat dengan warna yang komplementer.

Karya Vasarely ini, masih dalam ungkapan komposisi bentuk yang cukup bersahaja. Akan tetapi, pembagian bidang dalam empat bagian dan irama bentuk-bentuk yang disusun dalam gerak diagonal, merupakan prinsip-prinsip dasar optical art yang sudah bisa dirasakan.  Apabila pandangan dikonsentrasikan pada susunan bentuk dan warna itu, akan terasa bahwa ada irama gerak tegas yang mengalir melingkar dari empat bidangnya. Karya-karya OpArt yang akhirnya merebak dan mengalami masa puncak di New York pada tahun 1960-an. OpArt ini merupakan refleksi pemikiran para modernis yang sangat kental dengan jiwa ilmu, pengetahuan, dan teknologi. Fenomena demikian itu adalah buah dari perkembangan satu sisi arus pada modernisme (abad ke-20) yang sangat peduli pada pencarian objektivitas. Hal itu dapat dilihat
dari munculnya abstraksionisme, yang terdiri dari neoplastisisme, konstruktivisme, dan suprematisme. Lewat karya Vasarely yang sederhana ini, refleksi jiwa objektivitas itu sangat kuat dapat dirasakan.");

